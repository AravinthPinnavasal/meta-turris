
m dffe9d8052d31b31e0837d81353cbb82e0f73d11 Mon Sep 17 00:00:00 2001
From: "rajakumaran.a" <rajakumaran.a@lnttechservices.com>
Date: Tue, 20 Aug 2019 09:37:01 +0000
Subject: [PATCH] pandm-turris-macro

Signed-off-by: rajakumaran.a <rajakumaran.a@lnttechservices.com>
---
 source-arm/TR-181/board_sbapi/cosa_deviceinfo_apis.c                | 4 ++++
 source-arm/TR-181/board_sbapi/cosa_ip_apis.c                        | 5 +++++
 source-arm/TR-181/board_sbapi/cosa_x_cisco_com_devicecontrol_apis.c | 4 ++--
 source/TR-181/middle_layer_src/cosa_x_cisco_com_devicecontrol_dml.c | 4 ++--
 4 files changed, 13 insertions(+), 4 deletions(-)

diff --git a/source-arm/TR-181/board_sbapi/cosa_deviceinfo_apis.c b/source-arm/TR-181/board_sbapi/cosa_deviceinfo_apis.c
index 88ce5f7..7be5e67 100644
--- a/source-arm/TR-181/board_sbapi/cosa_deviceinfo_apis.c
+++ b/source-arm/TR-181/board_sbapi/cosa_deviceinfo_apis.c
@@ -107,6 +107,10 @@
 #include "ccsp_vendor.h"
 #endif
 
+#ifdef _PLATFORM_TURRIS_
+#include "ccsp_vendor.h"
+#endif
+
 #ifdef _COSA_SIM_
 
 // this file is in integration_src.intel_usg_arm directory
diff --git a/source-arm/TR-181/board_sbapi/cosa_ip_apis.c b/source-arm/TR-181/board_sbapi/cosa_ip_apis.c
index 956b00a..156680c 100755
--- a/source-arm/TR-181/board_sbapi/cosa_ip_apis.c
+++ b/source-arm/TR-181/board_sbapi/cosa_ip_apis.c
@@ -307,6 +307,9 @@ static int _is_in_linux_bridge(char * if_name, char * br_name)
 #if defined(_COSA_BCM_MIPS_) || defined(_PLATFORM_RASPBERRYPI_) || defined(_ENABLE_DSL_SUPPORT_)
     #define COSA_USG_IF_NUM 3 // we only have 3 interfaces for XF3
 #endif
+#ifdef _PLATFORM_TURRIS_
+    #define COSA_USG_IF_NUM 3
+#endif
 
 typedef struct USG_IF_CFG
 {
@@ -321,8 +324,10 @@ USG_IF_CFG_T g_usg_if_cfg[COSA_USG_IF_NUM] =
     {"erouter0",    COSA_DML_LINK_TYPE_EthLink, TRUE},
 #if defined(_COSA_INTEL_USG_ARM_) && !defined(_ENABLE_DSL_SUPPORT_)
 #ifndef _PLATFORM_RASPBERRYPI_
+#ifndef _PLATFORM_TURRIS_
     {"wan0",        COSA_DML_LINK_TYPE_DOCSIS,  TRUE},  /*DH  wan0 should never appear here -- CM extensions are for DOCSIS interfaces */
 #endif
+#endif
 #endif
     {"lo",          COSA_DML_LINK_TYPE_EthLink, FALSE}, /*DH  change the value of gDmsbIpIfLoopbackInstNum too, if "lo" is moved to a different location */
     /*
diff --git a/source-arm/TR-181/board_sbapi/cosa_x_cisco_com_devicecontrol_apis.c b/source-arm/TR-181/board_sbapi/cosa_x_cisco_com_devicecontrol_apis.c
index c14c1ab..5c78392 100755
--- a/source-arm/TR-181/board_sbapi/cosa_x_cisco_com_devicecontrol_apis.c
+++ b/source-arm/TR-181/board_sbapi/cosa_x_cisco_com_devicecontrol_apis.c
@@ -3503,7 +3503,7 @@ CosaDmlLanMngm_SetConf(ULONG ins, PCOSA_DML_LAN_MANAGEMENT pLanMngm)
     char str[IFNAME_SZ];    
     char *enableStr;
     napt_mode_t napt;
-#if !defined(_CBR_PRODUCT_REQ_) && !defined(_PLATFORM_RASPBERRYPI_) && !defined(_HUB4_PRODUCT_REQ_) // MOCA is not present for TCCBR environment, HUB4 and RaspberryPi environment
+#if !defined(_CBR_PRODUCT_REQ_) && !defined(_PLATFORM_RASPBERRYPI_) && !defined(_HUB4_PRODUCT_REQ_) && !defined(_PLATFORM_TURRIS_)// MOCA is not present for TCCBR environment, HUB4 and RaspberryPi environment
 	parameterValStruct_t **valMoCAstatus;
 	char pMoCAComponentName[64]="eRT.com.cisco.spvtg.ccsp.moca";
 	char pComponentPath[64]="/com/cisco/spvtg/ccsp/moca";
@@ -3558,7 +3558,7 @@ CosaDmlLanMngm_SetConf(ULONG ins, PCOSA_DML_LAN_MANAGEMENT pLanMngm)
 		}
 
         Utopia_SetBridgeSettings(&utctx,&bridge_info);
-#if !defined(_CBR_PRODUCT_REQ_) && !defined(_PLATFORM_RASPBERRYPI_) && !defined(_HUB4_PRODUCT_REQ_) // MOCA is not present for TCCBR environment, HUB4 and RaspberryPi environment
+#if !defined(_CBR_PRODUCT_REQ_) && !defined(_PLATFORM_RASPBERRYPI_) && !defined(_HUB4_PRODUCT_REQ_) && !defined(_PLATFORM_TURRIS_)// MOCA is not present for TCCBR environment, HUB4 and RaspberryPi environment
 		ret = CcspBaseIf_getParameterValues(
 		    bus_handle,
 		    pMoCAComponentName,
diff --git a/source/TR-181/middle_layer_src/cosa_x_cisco_com_devicecontrol_dml.c b/source/TR-181/middle_layer_src/cosa_x_cisco_com_devicecontrol_dml.c
index 36503a8..ce8f593 100644
--- a/source/TR-181/middle_layer_src/cosa_x_cisco_com_devicecontrol_dml.c
+++ b/source/TR-181/middle_layer_src/cosa_x_cisco_com_devicecontrol_dml.c
@@ -2020,7 +2020,7 @@ LanMngm_Validate
     /* check subnetmask */
     /* Subnet mask MUST accept ONLY the following IP addresses: */
     /* 255.255.255.0, 255.255.0.0, 255.0.0.0, 255.255.255.128, 255.255.255.252 */
-#if defined(_XB6_PRODUCT_REQ_)  || defined(_PLATFORM_RASPBERRYPI_) || defined (_HUB4_PRODUCT_REQ_)
+#if defined(_XB6_PRODUCT_REQ_)  || defined(_PLATFORM_RASPBERRYPI_) || defined (_HUB4_PRODUCT_REQ_) || defined(_PLATFORM_TURRIS_)
     if(pLanMngm->LanSubnetMask.Value != 0x00FFFFFF &&
        pLanMngm->LanSubnetMask.Value != 0x0000FFFF &&
        pLanMngm->LanSubnetMask.Value != 0x000000FF &&  
@@ -2099,7 +2099,7 @@ LanMngm_Validate
     }else if(pLanMngm->LanIPAddress.Dot[0] == 172 && pLanMngm->LanIPAddress.Dot[1] >= 16 && pLanMngm->LanIPAddress.Dot[1] <= 31){
         return TRUE;
     }
-#if defined(_XB6_PRODUCT_REQ_) || defined (_CBR_PRODUCT_REQ_) || defined(_PLATFORM_RASPBERRYPI_) || defined (_HUB4_PRODUCT_REQ_)
+#if defined(_XB6_PRODUCT_REQ_) || defined (_CBR_PRODUCT_REQ_) || defined(_PLATFORM_RASPBERRYPI_) || defined (_HUB4_PRODUCT_REQ_) || defined(_PLATFORM_TURRIS_)
     else if((pLanMngm->LanIPAddress.Value & 0x0000FFFF) == 0x0000A8C0)
 #else
    else if((pLanMngm->LanIPAddress.Value & 0xFFFF0000) == 0xC0A80000)
-- 
2.16.2


